# BPM + E&F ComPatch â€” technology compatibility
# Goal: ensure E&F finance tech hooks survive when BPM is loaded after E&F.
#
# Primary conflict:
# - Both mods do `REPLACE:currency_standards` (BPM tweaks era/modifiers; E&F uses it to auto-activate fiat law + finance progression).
# - With load order E&F -> BPM, BPM would overwrite E&F and E&F's monetary system breaks.
#
# This patch merges BOTH mods into one `REPLACE:currency_standards`:
# - Keep E&F's on_researched hook (fiat activation)
# - Include BPM's modifiers + prereqs

REPLACE:currency_standards = {
	# Unlocks Payroll Tax - Income Taxation Law
	era = era_2 #era_1
	texture = "gfx/interface/icons/invention_icons/currency_standards.dds"
	category = society

	# From BPM
	modifier = {
		country_institution_centralization_max_investment_add = 1
		country_institution_economy_max_investment_add = 1
	}

	unlocking_technologies = {
		# From E&F
		banking

		# From BPM
		international_trade
		centralization
	}

	on_researched = {
		if  = {
			limit = {
				not = {
					or = {
						has_technology_researched = central_banking
						has_technology_researched = metalique_standard
					}
				}
			}
			activate_law = law_type:law_fiat_standard
		}

		# Ensure E&F monetary ideologies are assigned even if currency_standards is researched mid-game
		bpm_setup_country_monetary_ideologies = yes
	}

	ai_weight = {
		value = 3 # Very important in general

		if = {
			limit = { has_journal_entry = je_sick_man_bureaucracy }
			add = 20
		}
	}
}

