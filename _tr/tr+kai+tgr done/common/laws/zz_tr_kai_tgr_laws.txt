# ComPatch: Tech & Res + Kuromi + TGR
# - Merge Tech&Res expanded destroy-lists for Industry Banned / Extraction Economy with TGR centralization swap.
# - Merge Kuromi AI enact weights into TGR taxation law rework.

REPLACE:law_industry_banned = {
	group = lawgroup_economic_system

	icon = "gfx/interface/icons/law_icons/industry_banned.dds"
	progressiveness = 0

	unlocking_technologies = {
		romanticism
	}

	on_activate = {
		custom_tooltip = industry_banned_tt
		custom_tooltip = {
			text = industry_banned_destroy_tt
			every_scope_state = {
				if = { limit = { has_building = building_chemical_plant } remove_building = building_chemical_plant }
				if = { limit = { has_building = building_synthetics_plant } remove_building = building_synthetics_plant }
				if = { limit = { has_building = building_steel_mill } remove_building = building_steel_mill }
				if = { limit = { has_building = building_power_plant } remove_building = building_power_plant }
				if = { limit = { has_building = building_motor_industry } remove_building = building_motor_industry }
				if = { limit = { has_building = building_automotive_industry } remove_building = building_automotive_industry }
				if = { limit = { has_building = building_electrics_industry } remove_building = building_electrics_industry }
				if = { limit = { has_building = building_munition_plant } remove_building = building_munition_plant }

				# Tech&Res extended industry list
				if = { limit = { has_building = building_alloys_plant } remove_building = building_alloys_plant }
				if = { limit = { has_building = building_mendelejew_synthetic_rubber_factory } remove_building = building_mendelejew_synthetic_rubber_factory }
				if = { limit = { has_building = building_mendelejew_hydrogenation_plants } remove_building = building_mendelejew_hydrogenation_plants }
				if = { limit = { has_building = building_electronics_industry } remove_building = building_electronics_industry }
				if = { limit = { has_building = building_battery_plant } remove_building = building_battery_plant }
				if = { limit = { has_building = building_processors_foundry } remove_building = building_processors_foundry }
				if = { limit = { has_building = building_aircraft_industry } remove_building = building_aircraft_industry }
				if = { limit = { has_building = building_ecommerce_logistics } remove_building = building_ecommerce_logistics }
			}
		}
	}

	modifier = {
		building_group_bg_agriculture_throughput_add = 0.1
		building_group_bg_plantations_throughput_add = 0.1
		state_expected_sol_mult = -0.1
		interest_group_ig_rural_folk_pol_str_mult = 0.5
		state_aristocrats_investment_pool_contribution_add = 0.25
		country_private_construction_allocation_mult = 0.5
		country_production_tech_research_speed_mult = -0.25
		country_production_tech_spread_mult = -0.25
		building_nationalization_investment_return_add = 0.5
		country_government_dividends_reinvestment_add = 0.25
		country_government_dividends_efficiency_add = 0.3
		state_peasants_education_access_add = -0.10
		country_disable_nationalization_without_compensation_bool = yes
		country_economic_dependence_on_overlord_add = -0.5
		country_free_charters_add = 1
	}

	ai_will_do = {
		OR = {
			has_law = law_type:law_traditionalism
			literacy_rate < 0.4
		}
	}

	ai_enact_weight_modifier = { #Petitions
		value = 0

		if = {
			limit = { ai_has_enact_weight_modifier_journal_entries = yes }
			add = 750
		}
	}
}

REPLACE:law_extraction_economy = {
	group = lawgroup_economic_system

	icon = "gfx/interface/icons/law_icons/extraction_economy.dds"
	progressiveness = 0

	unlocking_technologies = {
		colonization
	}

	disallowing_laws = {
		law_anarchy
		law_women_in_the_fields
	}

	can_enact = {
		is_subject = yes
	}

	on_activate = {
		custom_tooltip = industry_banned_tt
		custom_tooltip = {
			text = industry_banned_destroy_tt
			every_scope_state = {
				if = { limit = { has_building = building_chemical_plant } remove_building = building_chemical_plant }
				if = { limit = { has_building = building_synthetics_plant } remove_building = building_synthetics_plant }
				if = { limit = { has_building = building_steel_mill } remove_building = building_steel_mill }
				if = { limit = { has_building = building_motor_industry } remove_building = building_motor_industry }
				if = { limit = { has_building = building_automotive_industry } remove_building = building_automotive_industry }
				if = { limit = { has_building = building_electrics_industry } remove_building = building_electrics_industry }
				if = { limit = { has_building = building_munition_plant } remove_building = building_munition_plant }

				# Tech&Res extended industry list
				if = { limit = { has_building = building_alloys_plant } remove_building = building_alloys_plant }
				if = { limit = { has_building = building_mendelejew_synthetic_rubber_factory } remove_building = building_mendelejew_synthetic_rubber_factory }
				if = { limit = { has_building = building_mendelejew_hydrogenation_plants } remove_building = building_mendelejew_hydrogenation_plants }
				if = { limit = { has_building = building_electronics_industry } remove_building = building_electronics_industry }
				if = { limit = { has_building = building_battery_plant } remove_building = building_battery_plant }
				if = { limit = { has_building = building_processors_foundry } remove_building = building_processors_foundry }
				if = { limit = { has_building = building_aircraft_industry } remove_building = building_aircraft_industry }
				if = { limit = { has_building = building_ecommerce_logistics } remove_building = building_ecommerce_logistics }
			}
		}

		# TGR: extraction economy forces decentralization variants
		if = {
			limit = { has_law = law_type:law_administrative_centralism }
			deactivate_law = law_type:law_administrative_centralism
			activate_law = law_type:law_local_autonomies
		}
		else_if = {
			limit = { has_law = law_type:law_economic_centralism }
			deactivate_law = law_type:law_economic_centralism
			activate_law = law_type:law_local_autonomies
		}
	}

	modifier = {
		building_group_bg_agriculture_throughput_add = 0.1
		building_group_bg_plantations_throughput_add = 0.1
		building_group_bg_extraction_throughput_add = 0.1
		state_shopkeepers_investment_pool_efficiency_mult = -0.5
		state_bureaucrats_investment_pool_efficiency_mult = -0.5
		state_capitalists_investment_pool_efficiency_mult = -0.25
		state_farmers_investment_pool_efficiency_mult = -0.75
		state_clergymen_investment_pool_efficiency_mult = -0.75
		state_aristocrats_investment_pool_efficiency_mult = -0.75
		country_private_construction_allocation_mult = 0.5
		building_nationalization_investment_return_add = 0.5
		country_disable_nationalization_without_compensation_bool = yes
		country_economic_dependence_on_overlord_add = 0.5
	}

	ai_will_do = { always = no }

	ai_enact_weight_modifier = { #Petitions
		value = 0

		if = {
			limit = { ai_has_enact_weight_modifier_journal_entries = yes }
			add = 750
		}
	}
}

# --- Taxation laws: keep TGR rework + add Kuromi AI weights ---

REPLACE:law_per_capita_based_taxation = {
	group = lawgroup_taxation

	progressiveness = 0

	icon = "gfx/interface/icons/law_icons/per_capita_based_taxation.dds"

	disallowing_laws = {
		law_traditionalism
	}

	unlocking_technologies = {
		currency_standards
	}

	modifier = {
	}

	ai_enact_weight_modifier = { #Petitions
		value = 0

		if = {
			limit = { ai_has_enact_weight_modifier_journal_entries = yes }
			add = 750
		}

		# Kuromi: prioritize moving away from Land/Consumption once peasants drop
		if = {
			limit = {
				OR = {
					has_law_or_variant = law_type:law_consumption_based_taxation
					has_law_or_variant = law_type:law_land_based_taxation
				}
				pop_type_percent_country = {
					pop_type = peasants
					percent < 0.75
				}
			}
			add = 1000
		}

		# Kuromi: don't go backwards from proportional taxation once rich
		if = {
			limit = {
				has_law_or_variant = law_type:law_proportional_taxation
				kai_gdp_per_capita >= 1.5
			}
			add = -1000
		}

		# Kuromi: tech-based push to ditch land taxation
		if = {
			limit = {
				OR = {
					has_technology_researched = civilizing_mission
					has_technology_researched = human_rights
					has_technology_researched = pan-nationalism
				}
				has_law_or_variant = law_type:law_land_based_taxation
			}
			add = 1000
		}

		# TGR: campaign/JEs push (Tanzimat/Meiji/Great Reforms/etc)
		if = {
			limit = {
				OR = {
					has_journal_entry = je_sick_man_bureaucracy
					has_modifier = shogun_ig_forced_to_open_market
					has_journal_entry = je_meiji_main
					has_journal_entry = je_great_reforms_bureaucratic
				}
				has_law = law_type:law_land_based_taxation
			}
			add = 5000
		}
	}
}

REPLACE:law_proportional_taxation = {
	group = lawgroup_taxation

	progressiveness = 50

	icon = "gfx/interface/icons/law_icons/proportional_taxation.dds"

	disallowing_laws = {
		law_traditionalism
	}

	unlocking_technologies = {
		egalitarianism
	}

	modifier = {
	}

	ai_enact_weight_modifier = { #Petitions
		value = 0

		if = {
			limit = { ai_has_enact_weight_modifier_journal_entries = yes }
			add = 750
		}

		# Kuromi: tax reform is important once economy matures
		if = {
			limit = {
				OR = {
					has_law_or_variant = law_type:law_consumption_based_taxation
					has_law_or_variant = law_type:law_land_based_taxation
					has_law_or_variant = law_type:law_per_capita_based_taxation
				}
				kai_gdp_per_capita >= 1.5
			}
			add = 1000
		}

		# TGR: campaign/JEs push (Tanzimat/Meiji/Great Reforms/etc)
		if = {
			limit = {
				OR = {
					has_journal_entry = je_sick_man_bureaucracy
					has_modifier = shogun_ig_forced_to_open_market
					has_journal_entry = je_meiji_main
					has_journal_entry = je_great_reforms_bureaucratic
				}
				has_law = law_type:law_land_based_taxation
			}
			add = 5000
		}
	}
}

