#############################################
# pb+ef: PSC scope fix
# Fixes startup spam:
#   has_active_production_method [ Wrong scope for trigger: none, expected building ]
# coming from PSC/common/script_values/PSC_construction_values.txt:678/684/690
#
# Root cause: `b:building_construction_regulator = { has_active_production_method = ... }`
# is evaluated even in states without that building, producing an empty (none) building scope.
#############################################

REPLACE_OR_CREATE:calculate_state_construction_base_price = {
	# Default to the regulator's default PM (pm_wood_point_conversion) when regulator is missing / not initialized yet.
	value = wood_construction_good_base_price

	# Only inspect production methods if the regulator building exists in this state.
	if = {
		limit = { has_building = building_construction_regulator }
		b:building_construction_regulator = {
			if = {
				limit = { has_active_production_method = pm_wood_point_conversion }
				value = wood_construction_good_base_price
			}
			else_if = {
				limit = { has_active_production_method = pm_iron_point_conversion }
				value = iron_construction_good_base_price
			}
			else_if = {
				limit = { has_active_production_method = pm_steel_point_conversion }
				value = steel_construction_good_base_price
			}
			else = {
				value = arc_welded_construction_good_base_price
			}
		}
	}
}

